# Проект 5. Задача регрессии
<table>
  <tr style="vertical-align:middle">
  <tr style="vertical-align:middle">
    <!-- <th><img src = 'https://i.hh.ru/logos/svg/hh.ru__min_.svg?v=11032019'></th> -->
    <!-- <th><img style="vertical-align:middle" img src = https://lms.skillfactory.ru/static/rg-theme/images/logo-header.svg></th> -->
    <!-- <th><img style="vertical-align:middle" img src = https://static.tildacdn.com/tild3862-3932-4061-b763-363135393134/logo.svg></th> -->
    <th height=30><img style="vertical-align:middle" img src = https://static.tildacdn.com/tild3736-6663-4331-b065-623334663336/SkillFactory.svg height=20></th>
  </tr>
</table>

## Оглавление
[1. Описание проекта](https://github.com/yaroslav-vorobyov/SF_DST/tree/main/PROJECT-5#Описание-проекта)

[2. Какой кейс решаем?](https://github.com/yaroslav-vorobyov/SF_DST/tree/main/PROJECT-5#Какой-кейс-решаем)

[3. Краткая информация о данных](https://github.com/yaroslav-vorobyov/SF_DST/tree/main/PROJECT-5#Краткая-информация-о-данных)

[4. Этапы работы над проектом](https://github.com/yaroslav-vorobyov/SF_DST/tree/main/PROJECT-5#Этапы-работы-над-проектом)

[5. Результаты](https://github.com/yaroslav-vorobyov/SF_DST/tree/main/PROJECT-5#Результаты)

  > Перейти прямо к [презентации решения кейса](https://github.com/yaroslav-vorobyov/SF_DST/blob/main/PROJECT-5/project/Project-5.ipynb)

[6. Выводы](https://github.com/yaroslav-vorobyov/SF_DST/tree/main/PROJECT-5#Выводы)  

[7. Фидбэк от ментора](https://github.com/yaroslav-vorobyov/SF_DST/tree/main/PROJECT-5#Фидбэк-от-ментора)

<br>

<center> <img src=https://storage.googleapis.com/kaggle-competitions/kaggle/3333/media/taxi_meter.png align="right" width="300"/> </center>

## Описание проекта
Представьте, что вы заказываете такси из одной точки Нью-Йорка в другую, причём необязательно, что конечная точка должна находиться в пределах города. Сколько вы должны будете заплатить за поездку?

Известно, что стоимость такси в США рассчитывается на основе фиксированной ставки и тарифной стоимости, величина которой зависит от времени и расстояния. Тарифы варьируются в зависимости от города.

В свою очередь, время поездки зависит от множества факторов, таких как направление поездки, время суток, погодные условия и так далее.

Таким образом, если мы разработаем алгоритм, способный определять длительность поездки, мы сможем прогнозировать её стоимость самым тривиальным образом, например, просто умножая стоимость на заданный тариф.

<br>

### Какой кейс решаем?
**Бизнес-задача:** определить характеристики и с их помощью спрогнозировать длительность поездки на такси.

**Техническая задача как для специалиста в Data Science:** построить модель машинного обучения, которая на основе предложенных характеристик клиента будет предсказывать числовой признак — время поездки такси, то есть решить задачу регрессии.

<br>

### Задачи проекта:

1. Сформировать набор данных на основе нескольких источников информации

2. Спроектировать новые признаки с помощью Feature Engineering и выявить наиболее значимые при построении модели

3. Исследовать предоставленные данные и выявить закономерности

4. Построить несколько моделей и выбрать из них наилучшую по заданной метрике

5. Спроектировать процесс предсказания времени длительности поездки для новых данных

:arrow_up:[к оглавлению](https://github.com/yaroslav-vorobyov/SF_DST/tree/main/PROJECT-5#Оглавление)

<br>

**Условия:**
- Решение оформляется только в *Jupyter Notebook*.
- Решение оформляется в соответствии с *ноутбуком-шаблоном*.
- Не следует создавать много ячеек для решения задачи — это проявляет неудобства при проверке.
- Код на *Python* должен быть читаемым и понятным: имена переменных и функций отражают их сущность. Не забывать про отступы, разметку и комментарии в коде.
- Вывод оформляется в формате *Markdown* в отдельной ячейке.

<br>

<!-- <table>
  <tbody>
    <tr style="vertical-align:middle">
      <td style="background-color: #2e765e; color: white; font-weight: bold">2 балла</td>
      <td style="align:left">Правильность решения задач, логичность построения запросов</td>
    </tr>
    <tr>
      <td style="background-color: #2e765e; color: white; font-weight: bold">2 балла</td>
      <td style="align:left">Читабельность и верное форматирование запросов и кода на Python, наличие комментариев в запросах;<br>Аккуратность оформления решения</td>
    </tr>
    <tr>
      <td style="background-color: #2e765e; color: white; font-weight: bold">2 балла</td>
      <td style="align:left">Логичность и полнота выводов</td>
    </tr>
    <tr>
      <td style="background-color: #2e765e; color: white; font-weight: bold">2 балла</td>
      <td style="align:left">Дополнительные исследования данных</td>
    </tr>
  </tbody>
</table> -->

<br>

**Что на практике:**
-   Учусь писать отличный код на Python;
-   Учусь строить оптимальные модели линейной регрессии LinearRegression, в т.ч. с полиномизацией и регуляризацией Ridge, "деревья решений" DecisionTreeRegressor, поиск оптимальных гиперпараметров для "дерева решений", ансамблирование - "случайный лес" RandomForestRegressor, градиентный бустинг над деревьями решений GradientBoostingRegressor, экстремальный градиентный бустинг XGBoost;
-   Учусь сравнивать модели с точки зрения метрик, параметров;
-   Учусь следить за оптимизацией метрик модели;
-   Учусь следить за оптимизацией модели;
-   Учусь эффективно работать с IDE VSCode;
-   Повышаю квалификацию по методам преобразования и очистки данных; 
-   Повышаю квалификацию с GitHub.

:arrow_up:[к оглавлению](https://github.com/yaroslav-vorobyov/SF_DST/tree/main/PROJECT-5#Оглавление)

<br>

### Краткая информация о данных

В данном проекте первоначальные данные представлены в виде совокупного датасета размером: почти 2.1 млн строк, 37 столбцов, типа object, float64 и int64, в отдельных столбцах присутствуют пропуски и дубликаты при присоединении данных в процессе обработки. По итогам обработки будут отобраны 25 признаков, наилучшим образом подходящих для предсказания целевой переменной в логарифмическом масштабе. В связи с этим необходимо более детально проанализировать структуру первоначальных данных, сделать выводы о дальнейших преобразованиях. Построить обучающие модели, которые должны предсказывать общую продолжительность поездки на такси в Нью-Йорке, выбрать лучшую из них.

**Датасеты**:

* ***train.csv*** содержит датасет тренировочных + валидационных данных, 1.5 млн строк и 11 полей со следующей информацией:

    Данные о клиенте и таксопарке:

    * *id* — уникальный идентификатор поездки;
    * *vendor_id* — уникальный идентификатор поставщика услуг (таксопарка), связанного с записью поездки.

    Временные характеристики:

    * *pickup_datetime* — дата и время, когда был включён счётчик поездки;
    * *dropoff_datetime* — дата и время, когда счётчик был отключён.

    Географическая информация:

    * *pickup_longitude* — долгота, на которой был включён счётчик;
    * *pickup_latitude* — широта, на которой был включён счётчик;
    * *dropoff_longitude* — долгота, на которой счётчик был отключён;
    * *dropoff_latitude* — широта, на которой счётчик был отключён.

    Прочие признаки:

    * *passenger_count* — количество пассажиров в транспортном средстве (введённое водителем значение);
    * *store_and_fwd_flag* — флаг, который указывает, сохранилась ли запись о поездке в памяти транспортного средства перед отправкой поставщику (Y — хранить и пересылать, N — не хранить и не пересылать поездку).

    **Целевой признак:**

    * *trip_duration* — продолжительность поездки в секундах.

<br>

* ***holiday_data.csv*** датасет содержит информацию о том, является ли день праздничным, собраны даты всех праздничных дней в Америке за 2016 год. Данные представлены в табличном формате CSV и содержат три столбца:

    * *day* — день недели;
    * *date* — дата;
    * *holiday* — наименование праздника.

<br>

* ***osrm_data_train.csv*** датасет содержит данные из OSRM (Open Source Routing Machine) для поездок к таблице с тренировочными данными. Интересуют только следующие столбцы:

    * *id* — идентификатор поездки;
    * *total_distance* — кратчайшее дорожное расстояние (в метрах) из точки, в которой был включён счётчик, до точки, в которой счётчик был выключен (согласно OSRM);
    * *total_travel_time* — наименьшее время поездки (в секундах) из точки, в которой был включён счётчик, до точки, в которой счётчик был выключен (согласно OSRM);
    * *number_of_steps* — количество дискретных шагов, которые должен выполнить водитель (поворот налево/поворот направо/ехать прямо и т.д.).

<br>

* ***weather_data.csv*** датасет содержит данные информацию о погодных условиях в Нью-Йорке в 2016 году. Интересуют только следующие столбцы:

    * *time* — дата измерения (с интервалом в час);
    * *temperature* — температура;
    * *visibility* — видимость;
    * *wind speed* — средняя скорость ветра;
    * *precip* — количество осадков;
    * *events* — погодные явления: Rain — дождь, Snow — снег, Fog — туман, None — отсутствие погодных явлений.

<br>

* ***test.csv*** содержит датасет тестовых данных, свыше 625 тыс. строк, набор полей идентичен тренировочному датасету, за исключением целевого признака.

<br>

* ***osrm_data_test.csv*** датасет содержит данные из OSRM (Open Source Routing Machine) для поездок к таблице с тестовыми данными, свыше 625 тыс. строк, набор полей идентичен датасету с данными OSRM к тренировочному датасету.

По причине большой размерности некоторых датасетов они не выгружались к проекту на Github, объём самых больших совокупно составляет почти 1.2 Гб, Github позволяет разместить файлы такого объёма, но только на платном тарифе, пока ссылки актуальны (в том числе после их смены) файлы можно загрузить по ссылкам, настроен механизм выгрузки файлов с данными, переименования и переноса файлов датасетов в процессе их первого считывания в моно-каталог **data**.

:arrow_up:[к оглавлению](https://github.com/yaroslav-vorobyov/SF_DST/tree/main/PROJECT-5#Оглавление)

<br>

### Требования для работы
*   Основой интерпретатор - Python 3.10 (у меня взят из Windows App Store для максимальной бесшовной интеграции с VSCode);
*   Дополнительные требования перечислены в requirements.txt (получены командой pip freeze > requirements.txt);
*   Установка всех недостающих дополнительных компонент:

            pip install -r requirements.txt

*   В проекте используется:
    
    *   scikit-learn:
            
            pip install -U scikit-learn
    
    Документация по использованию - [Guide scikit-learn](https://scikit-learn.org/stable/user_guide.html)

    *   XGBoost:

            pip install -U XGBoost

    Документация по использованию - [XGBoost](https://xgboost.readthedocs.io/en/stable/index.html)
    
    *   swifter:
            
            pip install -U swifter
    
    Документация по использованию - [swifter](https://github.com/jmcarpenter2/swifter/blob/master/docs/documentation.md)

    *   gdown:

            pip install -U gdown

    Документация по использованию - [gdown](https://github.com/wkentaro/gdown)

    *   fast unzipper:

            pip install -U fast_unzip

    Документация по использованию - [fast unzipper](https://github.com/Inferno2899/fast_unzip)

    *   rm:

            pip install -U rm

    Документация по использованию - [rm](https://github.com/andrewp-as-is/rm.py)

:arrow_up:[к оглавлению](https://github.com/yaroslav-vorobyov/SF_DST/tree/main/PROJECT-5#Оглавление)

<br>

### Этапы работы над проектом
- Ознакомление с описанием задачи;
- Знакомство с данными;
- Импортирование необходимых библиотек;
- Изучение датасета на предмет наличия пропусков и типов данных;
- Обработка данных: извлечение данных из выборки, создание новых признаков;
- Очистка и отбор признаков: преобразование и удаление признаков, на которых модель обучаться не будет, отбор признаков;
- Разделение данных для модели: выделение тестовой части, разделение тренингового датасета: 67% всех данных - на обучение, 33% данных - на валидацию, проверка размерности разделённых датасетов;
- Построение и обучение моделей;
- Сравнение и оценка целевых метрик на тестовом датасете;
- Проверка соответствия написанного кода стандарту PEP8;
- Оформление проекта.

<br>

### Результаты:

Проект c корректным выполнением кейса ["Задача регрессии"](https://github.com/yaroslav-vorobyov/SF_DST/blob/main/PROJECT-5/project/Project-5.ipynb).

<br>

### Выводы
В процессе выполнения кейса первоначальные данные были:
* Внимательно изучены исходные данные и проанализированы;
* Проведена подготовка данных к использованию: очистка, преобразование, исключение, создание признаков;
* Данные были исследованы на длительности поездок, выявлены зависимости, построены графики отражающие зависимости, сформированы выводы по данным;
* Построены обучающие модели, основанные на алгоритмах машинного обучения, выбраны несколько из них по минимальной целевой метрике RMSLE;
* Принято участие в соревновании по машинному обучению.

Для обучения модели, были взяты 25 значимых признаков из 37.

Для решения задачи регрессии в данном кейсе **хорошо себя показали модели**:
* XGBoost, 

* градиентного бустинга над деревьями решений.

---

<br>

* <font color=Tomato>**&cross;**</font> Линейная регрессия
* <font color=Tomato>**&cross;**</font> Полиномиальная регрессия 2-ой степени
* <font color=Tomato>**&cross;**</font> Дерево решений
* <font color=Tomato>**&cross;**</font> Случайный лес
* <font color=LightSeaGreen>**&check;**</font> **Градиентный бустинг над деревьями решений**
* <font color=LightSeaGreen>**&check;**</font> **XGBoost**

<br>

| Обученная модель | RMSLE<br> на валидационной выборке |
| :---: | :---: |
| LinearRegression | 0.53 |
| Ridge | 0.48 |
| DecisionTreeRegressor | 0.43 |
| RandomForestRegressor | 0.41 |
| **GradientBoostingRegressor** | <font color=LightSeaGreen>**0.393**</font> |
| **XGBoost** | <font color=LightSeaGreen>**0.391**</font> |

<br>

:arrow_up:[к оглавлению](https://github.com/yaroslav-vorobyov/SF_DST/tree/main/PROJECT-5#Оглавление)

<br>

### Фидбэк от ментора
<!-- * Фидбэк PROJECT-5.url - содержит ссылку на отзыв, файл находится на Google Drive ментора -->
* Фидбэк PROJECT-5.pdf - версия отзыва с полным оформлением, если по ссылке файл будет удалён
* Фидбэк PROJECT-5.txt - текстовая версия отзыва, если по ссылке файл будет удалён

Перейти к [отзыву](https://github.com/yaroslav-vorobyov/SF_DST/tree/main/PROJECT-5/docs)

<br>

Если информация по этому проекту покажется вам интересной или полезной, то я буду очень вам благодарен, если отметите репозиторий и профиль ⭐️⭐️⭐️-дами.